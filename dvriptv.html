<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>DVR iPTV</title>
  <link href="https://vjs.zencdn.net/8.5.2/video-js.css" rel="stylesheet"/>
  <style>
    body { background-color: #0a0a0a; color: white; font-family: "Segoe UI", sans-serif; margin: 0; padding: 0; }
    header { background-color: #330000; padding: 20px; font-size: 24px; font-weight: bold; letter-spacing: 5px;
      display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; }
    .logo { flex: 1; text-align: left; }
    .search { flex: 1; text-align: right; }
    .search input { padding: 8px 12px; border-radius: 20px; border: none; font-size: 14px; outline: none; max-width: 200px; }
    .video-wrapper { position: sticky; top: 0; z-index: 999; background-color: #0a0a0a; }
    .video-container { max-width: 900px; margin: auto; padding: 10px; }
    video { width: 100%; height: auto; border-radius: 10px; }
    #epg { margin-top: 15px; color: #fff; font-size: 14px; background: #1a1a1a; padding: 10px; border-radius: 8px; display: none; }
    h2 { margin-left: 20px; color: #ff6666; font-size: 20px; border-left: 10px solid #cc0000; padding-left: 10px; }
    .channel-group { margin-bottom: 20px; }
    .channel-list { display: flex; flex-wrap: wrap; gap: 15px; padding: 1px 10px; }
    .channel { width: 100px; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; text-align: center; }
    .channel:hover, .channel.active-channel { transform: scale(1.08); box-shadow: 0 0 10px #ff0000; border: 2px solid #ffffff; }
    .channel img { width: 100%; border-radius: 15px; border: 1px solid #ffffff; }
    .channel-name { margin-top: 6px; font-size: 14px; }
    footer { text-align: center; padding: 20px; color: #bfbfbf; font-size: 14px; }
    @media (max-width: 600px) {
      header { font-size: 20px; padding: 15px; }
      h2 { font-size: 18px; margin-left: 10px; padding-left: 8px; }
      .channel { width: 80px; }
      .channel-name { font-size: 11px; }
      .video-container { padding: 5px; }
      footer { font-size: 12px; padding: 15px; }
    }
  </style>
</head>
<body>

<header>
  <div class="logo">DVR <span style="color:#ff4d4d;">iPTV</span></div>
  <div class="search">
    <input type="text" id="channelSearch" placeholder="ðŸ”Ž Search Channels..." />
  </div>
</header>

<div class="video-wrapper">
  <div class="video-container">
    <video id="tataplayer" class="video-js vjs-default-skin" controls preload="auto"
      controlsList="nodownload"
      data-setup='{
        "techOrder": ["html5"],
        "fluid": true,
        "controlBar": {
          "volumePanel": true,
          "audioTrackButton": true,
          "subsCapsButton": true
        }
      }'>
    </video>
    <div id="epg">
      <strong>Now Playing:</strong> <span id="nowTitle">Loading...</span><br>
      <strong>Next:</strong> <span id="nextTitle">Loading...</span>
    </div>
  </div>
</div>

<div id="channel-container"></div>

<footer>
  Â© 2025 DVR iPTV â€” FOR EDUCATIONAL PURPOSES ONLY
</footer>

<script src="https://vjs.zencdn.net/8.5.2/video.min.js"></script>
<script>
  const player = videojs('tataplayer');
  const m3uUrl = "https://amitb3669.github.io/jiotv-plus/";

  async function loadChannels() {
    const res = await fetch(m3uUrl);
    const text = await res.text();

    const lines = text.split("\n");
    let channels = [];
    let current = {};

    lines.forEach(line => {
      line = line.trim();
      if (line.startsWith("#EXTINF")) {
        const nameMatch = line.match(/,(.*)$/);
        const logoMatch = line.match(/tvg-logo="(.*?)"/);
        const groupMatch = line.match(/group-title="(.*?)"/);

        current = {
          name: nameMatch ? nameMatch[1].trim() : "Unknown",
          logo: logoMatch ? logoMatch[1] : "",
          group: groupMatch ? groupMatch[1] : "Others"
        };
      } else if (line && !line.startsWith("#")) {
        current.url = line;
        channels.push(current);
        current = {};
      }
    });

    const groups = {};
    channels.forEach(ch => {
      if (!groups[ch.group]) groups[ch.group] = [];
      groups[ch.group].push(ch);
    });

    const container = document.getElementById("channel-container");
    container.innerHTML = "";

    Object.keys(groups).forEach(group => {
      const groupDiv = document.createElement("div");
      groupDiv.className = "channel-group";
      groupDiv.innerHTML = `<h2>${group}</h2>`;

      const listDiv = document.createElement("div");
      listDiv.className = "channel-list";

      groups[group].forEach(ch => {
        const item = document.createElement("div");
        item.className = "channel";
        item.onclick = () => changeChannel(ch.url, item);

        item.innerHTML = `
          <img src="${ch.logo || "https://via.placeholder.com/100"}" alt="${ch.name}">
          <div class="channel-name">${ch.name}</div>
        `;
        listDiv.appendChild(item);
      });

      groupDiv.appendChild(listDiv);
      container.appendChild(groupDiv);
    });

    document.querySelector(".channel")?.click();
  }

  function changeChannel(url, element) {
    player.pause();
    player.reset();
    player.src({ src: url, type: 'application/x-mpegURL' });
    player.play();

    // Telugu default language selection
    player.one('loadedmetadata', () => {
      const tracks = player.audioTracks();
      if (tracks && tracks.length) {
        for (let i = 0; i < tracks.length; i++) {
          const lang = (tracks[i].language || "").toLowerCase();
          if (lang === "te" || lang === "tel" || lang === "telugu") {
            tracks[i].enabled = true;
          } else {
            tracks[i].enabled = false;
          }
        }
      }
    });

    document.querySelectorAll('.channel').forEach(el => el.classList.remove('active-channel'));
    element.classList.add('active-channel');

    document.getElementById("epg").style.display = "block";
    document.getElementById("nowTitle").innerText = element.querySelector(".channel-name").innerText;
    document.getElementById("nextTitle").innerText = "Coming up soon...";
  }

  document.getElementById("channelSearch").addEventListener("input", function () {
    const term = this.value.toLowerCase();
    document.querySelectorAll(".channel").forEach(channel => {
      const name = channel.querySelector(".channel-name").innerText.toLowerCase();
      channel.style.display = name.includes(term) ? "block" : "none";
    });
  });

  loadChannels();
</script>
</body>
</html>
